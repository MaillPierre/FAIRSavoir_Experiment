@prefix rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> .
@prefix rdfs: <http://www.w3.org/2000/01/rdf-schema#> .
@prefix dcterms: <http://purl.org/dc/terms/> .
@prefix earl: <http://www.w3.org/ns/earl#> .
@prefix kgi: <http://ns.inria.fr/kg/index#> .
@prefix prov: <http://www.w3.org/ns/prov#> .

<> rdf:type kgi:TestQuery ;
    dcterms:isReferencedBy <manifest.ttl> ;
    dcterms:title "Object Property Complement Of" ;
    dcterms:description "Since class is a subclass of or is equivalent to a class with a complement restriction on the use of objectProperty to have values from restrictedClass, and resource is of type class, but has the link objectProperty to have values from an instance of restrictedClass, an inconsistency occurs." ;
    kgi:query """PREFIX void: <http://rdfs.org/ns/void#>
    PREFIX kgi: <http://ns.inria.fr/kg/index#>
    PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#>
    PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>
    PREFIX owl: <http://www.w3.org/2002/07/owl#>
    ASK {
        {
            ?class rdf:type owl:Class ;
                rdfs:subClassOf|owl:equivalentClass
                [ rdf:type owl:Class ;
                    owl:complementOf 
                    [ rdf:type owl:Restriction ;
                        owl:onProperty ?objectProperty ;
                        owl:someValuesFrom ?restrictedClass ] 
                ] .
            ?resource rdf:type ?class ;
                ?objectProperty [ rdf:type ?objectClass ] .
            ?objectProperty rdf:type owl:ObjectProperty .
            {
                FILTER(?objectClass = ?restrictedClass)
            }
            UNION
            {
                ?objectClass rdfs:subClassOf*|owl:equivalentClass ?restrictedClass . 
            }
        }
        UNION {
            GRAPH ?graph {
                ?class rdf:type owl:Class ;
                    rdfs:subClassOf|owl:equivalentClass
                    [ rdf:type owl:Class ;
                        owl:complementOf 
                        [ rdf:type owl:Restriction ;
                            owl:onProperty ?objectProperty ;
                            owl:someValuesFrom ?restrictedClass ] 
                    ] .
                ?resource rdf:type ?class ;
                    ?objectProperty [ rdf:type ?objectClass ] .
                ?objectProperty rdf:type owl:ObjectProperty .
                {
                    FILTER(?objectClass = ?restrictedClass)
                }
                UNION
                {
                    ?objectClass rdfs:subClassOf*|owl:equivalentClass ?restrictedClass . 
                }
            }
        }
        FILTER(DATATYPE(?value) = ?complement)
    }"""  .