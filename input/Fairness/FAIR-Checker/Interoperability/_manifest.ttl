@prefix mf:      <http://www.w3.org/2001/sw/DataAccess/tests/test-manifest#> .
@prefix kgi: <http://ns.inria.fr/kg/index#> .
@prefix dcterms: <http://purl.org/dc/terms/> .

<> a mf:Manifest ;
    mf:entries (
        <I1.ttl>
        <I1A.ttl>
        <I1B.ttl>
        <I2.ttl>
        <I2A.ttl>
        <I2B.ttl>
        <I3.ttl>
    ) .

<I1.ttl> a mf:ManifestEntry ;
    kgi:onSuccess (
        [
            dcterms:description "There is a dataset description. " ;
            mf:action """
                PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>
                PREFIX void: <http://rdfs.org/ns/void#>
                PREFIX dcat: <http://www.w3.org/ns/dcat#>
                PREFIX dcmitype: <http://purl.org/dc/dcmitype/>
                PREFIX schema: <http://schema.org/>
                PREFIX sd: <http://www.w3.org/ns/sparql-service-description#>
                PREFIX prov: <http://www.w3.org/ns/prov#>
                PREFIX pav: <http://purl.org/pav/>
                PREFIX foaf: <http://xmlns.com/foaf/0.1/>
                PREFIX dqv: <http://www.w3.org/ns/dqv#>
                PREFIX dce: <http://purl.org/dc/elements/1.1/>
                PREFIX dcterms: <http://purl.org/dc/terms/>
                PREFIX dataid: <http://dataid.dbpedia.org/ns/core#>
                INSERT {
                    GRAPH ?kgGraph {
                        ?kg dqv:hasQualityMeasurement ?measurement .
                        ?measurement a dqv:QualityMeasurement ;
                            rdfs:label "Machine readable format"@en ;
                            dqv:isMeasurementOf <https://w3id.org/fair/principles/latest/I1> ;
                            dqv:value ?value .
                    }
                } WHERE {
                    GRAPH ?kgGraph {
                        { ?kg a dcat:Dataset }
                        UNION { ?kg a void:Dataset }
                        UNION { ?kg a dcmitype:Dataset }
                        UNION { ?kg a schema:Dataset }
                        UNION { ?kg a sd:Dataset }
                        UNION { ?kg a dataid:Dataset }
                    }
                    BIND(IF (EXISTS { 
                            GRAPH ?kgGraph { 
                                ?s a dcat:Dataset .
                                ?s ?p ?o . 
                            } 
                        }, 2, 0) AS ?value)
                    BIND(Iri(CONCAT(STR(?kg), "#I1")) AS ?measurement)
                }
                """
        ]
    ) .

<I1A.ttl> a mf:ManifestEntry ;
    kgi:onSuccess (
        [
            mf:action """
                PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>
                PREFIX void: <http://rdfs.org/ns/void#>
                PREFIX dcat: <http://www.w3.org/ns/dcat#>
                PREFIX dcmitype: <http://purl.org/dc/dcmitype/>
                PREFIX schema: <http://schema.org/>
                PREFIX sd: <http://www.w3.org/ns/sparql-service-description#>
                PREFIX prov: <http://www.w3.org/ns/prov#>
                PREFIX pav: <http://purl.org/pav/>
                PREFIX foaf: <http://xmlns.com/foaf/0.1/>
                PREFIX dqv: <http://www.w3.org/ns/dqv#>
                PREFIX dce: <http://purl.org/dc/elements/1.1/>
                PREFIX dcterms: <http://purl.org/dc/terms/>
                PREFIX dataid: <http://dataid.dbpedia.org/ns/core#>
                INSERT {
                    GRAPH ?kgGraph {
                        ?kg dqv:hasQualityMeasurement ?measurement .
                        ?measurement a dqv:QualityMeasurement ;
                            rdfs:label "Any structured information"@en ;
                            dqv:isMeasurementOf <https://w3id.org/fair/principles/latest/I1#I1A> ;
                            dqv:value ?value .
                    }
                } WHERE {
                    GRAPH ?kgGraph {
                        { ?kg a dcat:Dataset }
                        UNION { ?kg a void:Dataset }
                        UNION { ?kg a dcmitype:Dataset }
                        UNION { ?kg a schema:Dataset }
                        UNION { ?kg a sd:Dataset }
                        UNION { ?kg a dataid:Dataset }
                        ?s ?p ?o
                    }
                    BIND(IF (EXISTS { GRAPH ?kgGraph { ?s ?p ?o . } }, 2, 0) AS ?value)
                    BIND(Iri(CONCAT(STR(?kg), "#I1A")) AS ?measurement)
                }
                """
        ]
        [
            mf:action """
                PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>
                PREFIX void: <http://rdfs.org/ns/void#>
                PREFIX dcat: <http://www.w3.org/ns/dcat#>
                PREFIX dcmitype: <http://purl.org/dc/dcmitype/>
                PREFIX schema: <http://schema.org/>
                PREFIX sd: <http://www.w3.org/ns/sparql-service-description#>
                PREFIX prov: <http://www.w3.org/ns/prov#>
                PREFIX pav: <http://purl.org/pav/>
                PREFIX foaf: <http://xmlns.com/foaf/0.1/>
                PREFIX dqv: <http://www.w3.org/ns/dqv#>
                PREFIX dce: <http://purl.org/dc/elements/1.1/>
                PREFIX dcterms: <http://purl.org/dc/terms/>
                PREFIX dataid: <http://dataid.dbpedia.org/ns/core#>
                INSERT {
                    GRAPH ?kgGraph {
                        ?kg dqv:hasQualityMeasurement ?measurement .
                        ?measurement a dqv:QualityMeasurement ;
                            rdfs:label "Any structured information"@en ;
                            dqv:isMeasurementOf <https://w3id.org/fair/principles/latest/I1#I1A> ;
                            dqv:value 0 .
                    }
                } WHERE {
                    GRAPH ?kgGraph {
                        { ?kg a dcat:Dataset }
                        UNION { ?kg a void:Dataset }
                        UNION { ?kg a dcmitype:Dataset }
                        UNION { ?kg a schema:Dataset }
                        UNION { ?kg a sd:Dataset }
                        UNION { ?kg a dataid:Dataset }
                    }
                    FILTER(NOT EXISTS {
                        GRAPH ?kgGraph {
                            ?s ?p ?o .
                        }
                    })
                    BIND(Iri(CONCAT(STR(?kg), "#I1A")) AS ?measurement)
                }
                """
        ]
    ) .

<I1B.ttl> a mf:Manifest ;
    kgi:requiredAssets (
        <../Findability/F2B.ttl>
    ) ;
    kgi:onSuccess (
        [
            mf:action """
                PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>
                PREFIX void: <http://rdfs.org/ns/void#>
                PREFIX dcat: <http://www.w3.org/ns/dcat#>
                PREFIX dcmitype: <http://purl.org/dc/dcmitype/>
                PREFIX schema: <http://schema.org/>
                PREFIX sd: <http://www.w3.org/ns/sparql-service-description#>
                PREFIX prov: <http://www.w3.org/ns/prov#>
                PREFIX pav: <http://purl.org/pav/>
                PREFIX foaf: <http://xmlns.com/foaf/0.1/>
                PREFIX dqv: <http://www.w3.org/ns/dqv#>
                PREFIX dce: <http://purl.org/dc/elements/1.1/>
                PREFIX dcterms: <http://purl.org/dc/terms/>
                PREFIX dataid: <http://dataid.dbpedia.org/ns/core#>
                INSERT {
                    GRAPH ?kgGraph {
                        ?kg dqv:hasQualityMeasurement ?measurement .
                        ?measurement a dqv:QualityMeasurement ;
                            rdfs:label "Ontological and machine-resolvable formats"@en ;
                            dqv:isMeasurementOf <https://w3id.org/fair/principles/latest/I1#I1B> ;
                            dqv:value ?value .
                    }
                } WHERE {
                    GRAPH ?kgGraph {
                        ?kg dqv:hasQualityMeasurement ?F2Bmeasurement .
                        ?F2Bmeasurement a dqv:QualityMeasurement ;
                            dqv:isMeasurementOf <https://w3id.org/fair/principles/latest/F2#F2B> ;
                            dqv:value ?value .
                    }
                    BIND(Iri(CONCAT(STR(?kg), "#I1B")) AS ?measurement)
                }
            """
        ]
    ) .

<I2A.ttl> a mf:ManifestEntry ;
    kgi:onSuccess (
        [
            dcterms:description "At least one of the discoverability properties was found in metadata" ;
            mf:action """
                PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>
                PREFIX skos: <http://www.w3.org/2004/02/skos/core#>
                PREFIX void: <http://rdfs.org/ns/void#>
                PREFIX dcat: <http://www.w3.org/ns/dcat#>
                PREFIX dcmitype: <http://purl.org/dc/dcmitype/>
                PREFIX schema: <http://schema.org/>
                PREFIX sd: <http://www.w3.org/ns/sparql-service-description#>
                PREFIX prov: <http://www.w3.org/ns/prov#>
                PREFIX pav: <http://purl.org/pav/>
                PREFIX foaf: <http://xmlns.com/foaf/0.1/>
                PREFIX dqv: <http://www.w3.org/ns/dqv#>
                PREFIX dce: <http://purl.org/dc/elements/1.1/>
                PREFIX dcterms: <http://purl.org/dc/terms/>
                PREFIX dataid: <http://dataid.dbpedia.org/ns/core#>
                INSERT {
                    GRAPH ?kgGraph {
                        ?kg dqv:hasQualityMeasurement ?measurement .
                        ?measurement a dqv:QualityMeasurement ;
                            rdfs:label "Human-readable vocabularies"@en ;
                            dqv:isMeasurementOf <https://w3id.org/fair/principles/latest/I2#I2A> ;
                            dqv:value ?value .
                    }
                } WHERE {
                    GRAPH ?kgGraph {
                        { ?kg a dcat:Dataset }
                        UNION { ?kg a void:Dataset }
                        UNION { ?kg a dcmitype:Dataset }
                        UNION { ?kg a schema:Dataset }
                        UNION { ?kg a sd:Dataset }
                        UNION { ?kg a dataid:Dataset }
                    }
                    BIND( IF (EXISTS {
                        GRAPH ?kgGraph {
                            ?kg ?p ?o . 
                        }
                        VALUES ?p { 
                            dcterms:title
                            dcterms:abstract
                            dcterms:creator
                            dcterms:license
                            dcterms:language
                            rdfs:label
                            rdfs:comment
                            rdfs:seeAlso
                            skos:prefLabel
                            skos:altLabel
                            skos:definition
                            skos:example
                            skos:related
                            skos:broader
                            skos:narrower
                            skos:note
                        }
                    }, 2, 0) AS ?value )
                    BIND(Iri(CONCAT(STR(?kg), "#I2A")) AS ?measurement)
                }
                """
        ]
    ) .

<I2B.ttl> a mf:Manifest ;
    kgi:requiredAssets (
        <../Findability/F2A.ttl>
    ) ;
    kgi:onSuccess (
        [
            mf:action """
                PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>
                PREFIX void: <http://rdfs.org/ns/void#>
                PREFIX dcat: <http://www.w3.org/ns/dcat#>
                PREFIX dcmitype: <http://purl.org/dc/dcmitype/>
                PREFIX schema: <http://schema.org/>
                PREFIX sd: <http://www.w3.org/ns/sparql-service-description#>
                PREFIX prov: <http://www.w3.org/ns/prov#>
                PREFIX pav: <http://purl.org/pav/>
                PREFIX foaf: <http://xmlns.com/foaf/0.1/>
                PREFIX dqv: <http://www.w3.org/ns/dqv#>
                PREFIX dce: <http://purl.org/dc/elements/1.1/>
                PREFIX dcterms: <http://purl.org/dc/terms/>
                PREFIX dataid: <http://dataid.dbpedia.org/ns/core#>
                INSERT {
                    GRAPH ?kgGraph {
                        ?kg dqv:hasQualityMeasurement ?measurement .
                        ?measurement a dqv:QualityMeasurement ;
                            rdfs:label "Machine-readable vocabularies"@en ;
                            dqv:isMeasurementOf <https://w3id.org/fair/principles/latest/I2#I2B> ;
                            dqv:value ?value .
                    }
                } WHERE {
                    GRAPH ?kgGraph {
                        ?kg dqv:hasQualityMeasurement ?F2Ameasurement .
                        ?F2Ameasurement a dqv:QualityMeasurement ;
                            dqv:isMeasurementOf <https://w3id.org/fair/principles/latest/F2#F2A> ;
                            dqv:value ?value .
                    }
                    BIND(Iri(CONCAT(STR(?kgGraph), "#I2B")) AS ?measurement)
                }
            """
        ]
    ) .

<I2.ttl> a mf:Manifest ;
    kgi:requiredAssets (
        <../Findability/F2B.ttl>
    ) ;
    kgi:onSuccess (
        [
            mf:action """
                PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>
                PREFIX void: <http://rdfs.org/ns/void#>
                PREFIX dcat: <http://www.w3.org/ns/dcat#>
                PREFIX dcmitype: <http://purl.org/dc/dcmitype/>
                PREFIX schema: <http://schema.org/>
                PREFIX sd: <http://www.w3.org/ns/sparql-service-description#>
                PREFIX prov: <http://www.w3.org/ns/prov#>
                PREFIX pav: <http://purl.org/pav/>
                PREFIX foaf: <http://xmlns.com/foaf/0.1/>
                PREFIX dqv: <http://www.w3.org/ns/dqv#>
                PREFIX dce: <http://purl.org/dc/elements/1.1/>
                PREFIX dcterms: <http://purl.org/dc/terms/>
                PREFIX dataid: <http://dataid.dbpedia.org/ns/core#>
                INSERT {
                    GRAPH ?kgGraph {
                        ?kg dqv:hasQualityMeasurement ?measurement .
                        ?measurement a dqv:QualityMeasurement ;
                            rdfs:label "Machine-readable vocabularies"@en ;
                            dqv:isMeasurementOf <https://w3id.org/fair/principles/latest/I2> ;
                            dqv:value ?value .
                    }
                } WHERE {
                    GRAPH ?kgGraph {
                        ?kg dqv:hasQualityMeasurement ?F2Bmeasurement .
                        ?F2Bmeasurement a dqv:QualityMeasurement ;
                            dqv:isMeasurementOf <https://w3id.org/fair/principles/latest/F2#F2B> ;
                            dqv:value ?value .
                    }
                    BIND(Iri(CONCAT(STR(?kgGraph), "#I2")) AS ?measurement)
                }
            """
        ]
    ) .

<I3.ttl> a mf:Manifest ;
    kgi:onSuccess (
        [
            mf:action """PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>
                PREFIX void: <http://rdfs.org/ns/void#>
                PREFIX dcat: <http://www.w3.org/ns/dcat#>
                PREFIX dcmitype: <http://purl.org/dc/dcmitype/>
                PREFIX schema: <http://schema.org/>
                PREFIX sd: <http://www.w3.org/ns/sparql-service-description#>
                PREFIX prov: <http://www.w3.org/ns/prov#>
                PREFIX pav: <http://purl.org/pav/>
                PREFIX foaf: <http://xmlns.com/foaf/0.1/>
                PREFIX dqv: <http://www.w3.org/ns/dqv#>
                PREFIX dce: <http://purl.org/dc/elements/1.1/>
                PREFIX dcterms: <http://purl.org/dc/terms/>
                PREFIX dataid: <http://dataid.dbpedia.org/ns/core#>
                INSERT {
                    GRAPH ?kgGraph {
                        ?kg dqv:hasQualityMeasurement ?measurement .
                        ?measurement a dqv:QualityMeasurement ;
                            rdfs:label "External links"@en ;
                            dqv:isMeasurementOf <https://w3id.org/fair/principles/latest/I3> ;
                            dqv:value ?value .
                    }
                } WHERE {
                    {
                        SELECT (count(?ns) AS ?countVocab) ?kg ?kgGraph {
                            SELECT ?ns ?kg ?kgGraph {
                                {
                                    SELECT DISTINCT ?elem ?kg ?kgGraph {
                                        GRAPH ?kgGraph {
                                            { ?s ?elem ?o . }
                                            UNION { ?s a ?elem . }
                                            { ?kg a dcat:Dataset }
                                            UNION { ?kg a void:Dataset }
                                            UNION { ?kg a dcmitype:Dataset }
                                            UNION { ?kg a schema:Dataset }
                                            UNION { ?kg a sd:Dataset }
                                            UNION { ?kg a dataid:Dataset }
                                        }
                                    }
                                }
                                BIND(IRI(REPLACE( str(?elem), "(#|/)[^#/]*$", "$1")) AS ?ns)
                            }
                            GROUP BY ?kg ?ns ?kgGraph
                        } GROUP BY ?kg ?kgGraph
                    }
                    BIND(IF(?countVocab > 2, 2, 0) AS ?value)
                    BIND(Iri(CONCAT(STR(?kg), "#I3")) AS ?measurement)
                }
            """
        ]
    ) .